{% extends 'pybb/base.html' %}
{% load pybb_tags %}
{% load i18n %}

{% block pybb_title %}{{ topic }}{% endblock %}

{% block head %}
    {{ block.super }}
    {% include "pybb/markitup.html" %}
{% endblock head %}

{% block breadcrumb %}
    {{ block.super }}
    &#187; {% pybb_link topic.forum.category %} &#187; {% pybb_link topic.forum %} &#187; {{ topic }}
{% endblock %}

{% block content %}
    <h1>{{ topic.name }}</h1>
    {% with _('Posts') as label %}
    {% include "pybb/pagination/pagination.html" %}
    {% endwith %}

    <div class="posts">
        {% if first_post %}{% ifnotequal first_post post_list.0 %}
            {% with first_post as post %}
            <li class="first_post">{% include "pybb/post_template.html" %}</li>
            {% endwith %}
        {% endifnotequal %}{% endif %}
        {% for post in post_list %}
            {% include "pybb/post_template.html" %}
        {% endfor %}
    </div>
    <div>&nbsp;</div>
    {% with _('Posts') as label %}
    {% include "pybb/pagination/pagination.html" %}
    {% endwith %}

    {% if user.is_authenticated %}
    <div class="controls">
    {% if user.is_moderator %}
        {% if topic.sticky %}
        <a href="{% url pybb_unstick_topic topic.id %}">{% trans "Unstick topic" %}</a> /
        {% else %}
        <a href="{% url pybb_stick_topic topic.id %}">{% trans "Stick topic" %}</a> /
        {% endif %}

        {% if topic.closed %}
        <a href="{% url pybb_open_topic topic.id %}">{% trans "Open topic" %}</a> /
        {% else %}
        <a href="{% url pybb_close_topic topic.id %}">{% trans "Close topic" %}</a> /
        {% endif %}

        <a href="{% url pybb_merge_topics %}?topic={{ topic.id }}">{% trans 'Merge topics' %}</a> /
    {% endif %}

        {% if user.is_subscribed %}
        <a href="{% url pybb_delete_subscription topic.id %}?from_topic">{% trans "Unsubscribe" %}</a>
        {% else %}
        <a href="{% url pybb_add_subscription topic.id %}">{% trans "Subscribe" %}</a>
        {% endif %}
    </div>
    {% endif %}

    {% if user.is_authenticated %}
     {% if not user.pybb_profile.is_banned %}
      {% if not topic.closed %}
       {% include "pybb/add_post_form.html" %}
      {% endif %}
     {% endif %}
    {% endif %}

{% endblock %}
